# Anomaly Detection with the Cloud-based UEBA Log Data Set
This repository contains scripts to carry out anomaly detection in the CLUE log data set.

The publicly available CLUE-LDS (CLoud-based User Entity behavior analytics Log Data Set) contains system log events generated by real users of a customized [Nextcloud](https://nextcloud.com/) instance operated by [Huemer Group](https://www.huemer-group.com/hbox/). The data set spans over five years and contains events generated by more than 5000 anonymized users. Anonymization is carried out without loss of information, i.e., identical user and file names are replaced consistently with the same pseudonym. There exist 49 event types, such as events that report users logging into the system, editing files, sharing documents, changing configurations, etc. Some events also come with geolocations of users. For more information on the data set we refer to our publication at the bottom of this page.

As the CLUE-LDS only contains normal user and entity behavior, it is necessary to manually inject attacks to enable evaluation of anomaly detection systems. We simulate account hijacking by switching pairs of user identifiers (uid) at specific points in time. The first step is to check out this repository and then place the unarchived CLUE-LDS in the same directory:

```bash
user@ubuntu:~$ git clone https://github.com/ait-aecid/clue-lds.git
user@ubuntu:~$ cd clue-lds/
user@ubuntu:~/clue-lds$ mv ~/Downloads/clue.json .
```

The next step is to compute similarities between pairs of users so that behavior patterns of users that are selected for switching are not too similar (which would make detection very difficult) and not too different (which would make detection trivial). Running the following script generates a similarity matrix ``sim.txt`` as well as the file ``user_info.txt`` containing user information that is necessary for the subsequent steps.

```bash
user@ubuntu:~/clue-lds$ python3 get_user_similarity.py
```

Running the script takes several minutes. Note that there are several parameters for this and all following scripts, for example, for specifying the weights of the similarity computation. Check out the parameters with ``python3 get_user_similarity.py -h``.

The next step is to generate the log data set with injected anomalies. The following script randomly selects pairs of users based on the previously computed similarities and switches them at arbitrary points in time, which changes behavior patterns of affected users and thus enables evaluation of anomaly detection systems leveraging user and entity behavior analysis. Running the script as follows generates the file ``clue_anomaly.json`` that is identical to the original ``clue.json`` file except that some user identifiers are switched, and the ``labels.txt`` file containing the ground truth. The output of the script also shows which users were selected and at what point in time the injected anomaly occurs.

```bash
user@ubuntu:~/clue-lds$ python3 generate_test_file.py
Changing user pair with similarity 0.22:
 * User shocked-jade-roadrunner-pressoperator changed at 2020-07-20 00:00:00+00:00 (user originally carried out 3065 total events and 10 unique events during 65 active days).
 * User shared-fuchsia-cardinal-buildingadvisor changed at 2020-07-20 00:00:00+00:00 (user originally carried out 6186937 total events and 24 unique events during 1836 active days).
Changing user pair with similarity 0.48:
 * User married-copper-leech-motorengineer changed at 2022-06-13 00:00:00+00:00 (user originally carried out 5713 total events and 13 unique events during 165 active days).
 * User new-coffee-herring-aircraftdesigner changed at 2022-07-04 00:00:00+00:00 (user originally carried out 8506 total events and 8 unique events during 108 active days).
...
 ```

This repository contains an exemplary anomaly detection method based on event count vectors generated for each day where a user is active. Running the following script shows all relevant metrics for evaluation. Again, there are several parameters to be specified when running the program, for example, the similarity threshold that is set to 0.6 in the following example.

```bash
user@ubuntu:~/clue-lds$ python3 detect.py -t 0.6
Results with threshold = 0.6:
  Total = 9392
  Train = 757
  Detect = 9392
  TP_adj = 11
  TP = 11
  FP = 587
  TN = 8785
  FN = 9
  TPR_adj = 0.55
  TPR = Rec = 0.55
  FPR = 0.0626333760136577
  TNR = 0.9373666239863423
  Prec = 0.01839464882943144
  F1 = 0.03559870550161812
  ACC = 0.936541737649063
  R = 0.0745886294216179
```

If you use the CLUE data set or any of the scripts provided in this repository, please cite the following publication:
 * Landauer M., Skopik F., HÃ¶ld G., Wurzenberger M. (2022): A User and Entity Behavior Analytics Log Data Set for Anomaly Detection in Cloud Computing. Under Review.
